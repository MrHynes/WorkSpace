package pers.qiqcheng.ec.servlet.admin;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.jdom.Document;
import org.jdom.Element;
import org.jdom.JDOMException;
import org.jdom.input.SAXBuilder;

import pers.qiqcheng.ec.bean.admin.AdminBean;

public class AdminInfoServlet extends HttpServlet{

	public void getAdmin(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String flag=req.getParameter("flag");
		HttpSession session=req.getSession();
		String userName=(String) session.getAttribute("adminName");
		SAXBuilder builder = new SAXBuilder();
		List<AdminBean> items=new ArrayList<AdminBean>();
		AdminBean adminBean=null;
		Document doc;
		try {
			doc = builder.build(new File("F:\\WorkSpace\\ECProject\\WebContent\\WEB-INF\\info.xml"));
			Element foo = doc.getRootElement();
			List allChildren = foo.getChildren();
			for (int i = 0; i < allChildren.size(); i++) {
				/*if(userName!=null&&userName.equals(((Element) allChildren.get(i)).getChild("name").getText())){
					System.out.println("密码:" + ((Element) allChildren.get(i)).getChild("pwd").getText());
				}*/
				adminBean=new AdminBean();
				adminBean.setUserName(((Element) allChildren.get(i)).getChild("name").getText());
				adminBean.setRelName(((Element) allChildren.get(i)).getChild("relname").getText());
				adminBean.setSex(((Element) allChildren.get(i)).getChild("sex").getText());
				adminBean.setBirthDay(((Element) allChildren.get(i)).getChild("birthday").getText());
				adminBean.setEmail(((Element) allChildren.get(i)).getChild("email").getText());
				adminBean.setTelePhone(((Element) allChildren.get(i)).getChild("telphone").getText());
				adminBean.setAddress(((Element) allChildren.get(i)).getChild("address").getText());
				adminBean.setPostCode(((Element) allChildren.get(i)).getChild("postcode").getText());
				adminBean.setIdentify(((Element) allChildren.get(i)).getChild("identify").getText());
				adminBean.setRegisteTime(((Element) allChildren.get(i)).getChild("registeTime").getText());
				items.add(adminBean);
			}
			/*for (AdminBean adminBean2 : items) {
				System.out.println(adminBean2.toString());
			}*/
			session.setAttribute("admininfo", items);
			if("systemuser".equals(flag)){
				req.getRequestDispatcher("/backend/adminSysUser.jsp").forward(req, resp);
			}else {
				
			}
			
		} catch (JDOMException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		doPost(req, resp);
	}

	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String task=req.getParameter("task");
		if("getAdmin".equals(task)){
			getAdmin(req, resp);
		}
	}
	

}
